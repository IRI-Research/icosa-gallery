{% extends "base.html" %}

{% load asset_tags %}
{% load fontawesome_tags %}
{% load static %}

{% block extrahead %}
    <link rel="canonical" href="{{ request.scheme }}://{{ request.get_host }}{{ asset.get_absolute_url }}" />
{% endblock extrahead %}

{% block banner %}
{% if not asset.owner.is_claimed %}
{% include "partials/artist_info_banner.html" %}
{% endif %}
{% endblock banner %}

{% block content %}
<div class="sketch-info container">
    <div class="row">
        <div class="col">
            {% if asset.is_viewer_compatible %}
                <div id="icosa-viewer"></div>
            {% else %}
                <p>Sorry, we are unable to display this model in the viewer.</p>
            {% endif %}
            <div class="sketch-info-details">
                <h2>
                    {{ asset.name }}{% if user == request_user %}{% if asset.visibility == "PRIVATE" %} <span style="color:red;">(PRIVATE)</span>{% endif %}{% if asset.visibility == "UNLISTED" %} <span style="color:orange;">(UNLISTED)</span>{% endif %}{% endif %}
                    {% like_button request asset %}
                </h2>
                {% if asset.owner %}
                    <p class="sketch-byline">
                        <a href="/user/{{ asset.owner.url }}">{{ asset.owner.displayname }}</a> &bull; {{ asset.timestamp|date:"d/m/Y" }}
                    </p>
                {% endif %}
                {% if asset.description %}
                    <p>{{ asset.description|linebreaksbr }}</p>
                {% endif %}
                <p class="sketch-license">
                    {{ asset.get_license_icons }} {{ asset.get_license_display|default_if_none:"&copy; All rights reserved" }}
                </p>
                <p></p>
                {% if downloadable_formats %}
                    <p>
                        <a href="{% url 'asset_downloads' asset_url=asset.url %}" class="btn btn-primary btn-sm">
                            {% fa_icon "solid" "download" %} Downloads
                        </a>
                    </p>
                {% endif %}
                <p class="text-right actions">
                    <small>
                        <a href="{% url 'artist_info' %}">{% fa_icon "solid" "circle-question" %} Why is my work here? What can I do?</a>
                        <a href="{% url "report_asset" asset_url=asset.url %}">
                            {% fa_icon "solid" "flag" %} Report
                        </a>
                    </small>
                </p>
                {% if request.user.is_superuser %}
                    <form id="super-preview-form" action="{% url 'make_asset_preview_image' asset_url=asset.url %}" method="post">
                        {% csrf_token %}
                        <input type="hidden" name="preview_image">
                        <input type="submit" class="btn btn-danger btn-inline" id="super-preview-form-submit" value="Generate preview image">
                    </form>
                    <p>
                        <button class="btn btn-danger" id="viewer-guide-button">Show guides</button>
                    </p>
                    <script>
                        let previewForm = document.querySelector("#super-preview-form");
                        let previewButton = document.querySelector("#super-preview-form-submit");
                        let previewInput = document.querySelector("input[name='preview_image']");
                        function handleSubmit() {
                            let data = viewer.captureThumbnail(1280, 720);
                            previewInput.value = data;
                            return false;
                        }
                        previewButton.addEventListener('click',handleSubmit, false);

                        let guideButton = document.querySelector("#viewer-guide-button");
                        function handleGuides() {
                            viewer.canvas.parentElement.style.position = 'relative';
                            viewer.canvas.parentElement.appendChild(
                                Object.assign(
                                    document.createElement('div'),
                                    { style: 'position:absolute;top:26%;height:48%;width:100%;border-top:1px solid red;border-bottom:1px solid red;pointer-events:none;' }
                                )
                            );
                        }
                        guideButton.addEventListener('click',handleGuides, false);
                    </script>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% if asset.is_viewer_compatible %}
    {% include "partials/viewer.html" %}
{% endif %}
{% endblock content %}
